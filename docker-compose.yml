version: '3.4'

services:
  webapi:
    image: klinkby/clamrest
    build:
      context: src/Klinkby.ClamREST
      dockerfile: Dockerfile
    ports:
      - 5000:5000
    environment:
      - HOST=clamav
    depends_on:
      - clamav
    restart: always
    healthcheck:
      test: ["CMD", "wget", "http://localhost:5000/health", "-q", "-O", "-"]
      timeout: 3s
      interval: 10s
      retries: 3    
  clamav:
    image: mkodockx/docker-clamav:alpine
    restart: always
